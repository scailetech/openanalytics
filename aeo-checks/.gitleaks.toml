# Gitleaks Configuration for OpenAnalytics
# Enhanced secret detection for API keys, tokens, and credentials

title = "OpenAnalytics Security Configuration"

# Google/Gemini API Keys
[[rules]]
id = "google-api-key"
description = "Google API Key"
regex = '''AIza[0-9A-Za-z\\-_]{35}'''
keywords = ["AIza"]

# OpenAI API Keys
[[rules]]
id = "openai-api-key"
description = "OpenAI API Key"
regex = '''sk-[a-zA-Z0-9]{20}T3BlbkFJ[a-zA-Z0-9]{20}'''
keywords = ["sk-"]

# OpenRouter API Keys
[[rules]]
id = "openrouter-api-key"
description = "OpenRouter API Key"
regex = '''sk-or-v1-[a-zA-Z0-9\-_]{20,100}'''
keywords = ["sk-or-v1"]

# Serper API Keys
[[rules]]
id = "serper-api-key"
description = "Serper Dev API Key"
regex = '''[a-f0-9]{48}'''
keywords = ["serper"]

# Anthropic Claude API Keys
[[rules]]
id = "anthropic-api-key"
description = "Anthropic Claude API Key"
regex = '''sk-ant-api03-[a-zA-Z0-9\-_]{95}'''
keywords = ["sk-ant-api03"]

# Perplexity API Keys
[[rules]]
id = "perplexity-api-key"
description = "Perplexity API Key"
regex = '''pplx-[a-zA-Z0-9]{32}'''
keywords = ["pplx-"]

# Generic High-Entropy Strings (potential secrets)
[[rules]]
id = "high-entropy-base64"
description = "High entropy base64 string"
regex = '''(?:[A-Za-z0-9+\/]{4})*(?:[A-Za-z0-9+\/]{2}==|[A-Za-z0-9+\/]{3}=|[A-Za-z0-9+\/]{4})'''
entropy = 4.3
keywords = ["key", "secret", "token", "password", "credential"]

# JWT Tokens
[[rules]]
id = "jwt-token"
description = "JWT Token"
regex = '''eyJ[a-zA-Z0-9_\-]*\.eyJ[a-zA-Z0-9_\-]*\.[a-zA-Z0-9_\-]*'''
keywords = ["eyJ"]

# Railway Tokens
[[rules]]
id = "railway-token"
description = "Railway Token"
regex = '''railway_[a-zA-Z0-9]{20,}'''
keywords = ["railway_"]

# GitHub Tokens
[[rules]]
id = "github-token"
description = "GitHub Token"
regex = '''gh[pousr]_[A-Za-z0-9_]{36}'''
keywords = ["ghp_", "gho_", "ghu_", "ghs_", "ghr_"]

# Supabase Keys
[[rules]]
id = "supabase-key"
description = "Supabase Key"
regex = '''sb-[a-zA-Z0-9]{24}-[a-zA-Z0-9]{24}'''
keywords = ["supabase"]

# Allowlist for common false positives
[allowlist]
description = "Allowlist for known safe patterns"
paths = [
    ".gitleaks.toml",
    '''.*\.md$''',  # Documentation files (but still scan them)
    '''test-.*''', # Test files with mock data
]

# Patterns to ignore (mock/placeholder keys)
regexes = [
    '''sk-or-v1-mock-key-for-fallback''',     # Our mock OpenRouter key
    '''sk-or-v1-sample-key-for-testing''',    # Test key in JS files  
    '''your-.*-api-key''',                    # Placeholder patterns
    '''example-.*-key''',                     # Example patterns  
    '''test-.*-key''',                        # Test patterns
    '''AIzaSy.*EXAMPLE''',                    # Example Gemini keys
    '''sample-.*-key''',                      # Sample keys
]

# Files to ignore completely  
[allowlist.files]
paths = [
    ".env.example",
    ".env.template", 
    '''.*\.sample$''',
]

# Stop scanning when entropy is below this threshold for the high-entropy rule
[allowlist.entropy]
min = 3.0